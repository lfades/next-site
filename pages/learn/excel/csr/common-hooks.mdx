import Layout from '../../../../components/learn/Layout';
import AnswerBox from '../../../../components/learn/AnswerBox';

export const meta = {
  title: 'CSR',
  courseId: 'excel',
  lessonId: 'csr',
  stepId: 'common-hooks'
};

## Common Hooks

React Hooks are very powerful as you can see, and we can improve our current implementation even more.

Let's start by moving our new data fetch hook to a common lib, that way we can use it in any component, open `lib/shows.js` and replace the content with the following:

```jsx
import { useState, useEffect } from 'react';
import fetch from 'isomorphic-unfetch';

export async function getShows(id) {
  await new Promise(resolve => setTimeout(() => resolve(), 1000));

  if (id) {
    const res = await fetch(`https://api.tvmaze.com/shows/${id}`);
    const show = await res.json();

    return show;
  } else {
    const res = await fetch('https://api.tvmaze.com/search/shows?q=batman');
    const data = await res.json();

    return data.map(entry => entry.show);
  }
}

export function useShows() {
  const [shows, setShows] = useState();

  useEffect(() => {
    const fetchData = async () => {
      const shows = await getShows();
      setShows(shows);
    };
    fetchData();
  }, []);

  return shows;
}
```

`useShows()` follows the [name convention for hooks](https://reactjs.org/docs/hooks-overview.html#building-your-own-hooks), it fetches and returns the shows to any component using it.

We could also do the same to get the data about a single show, add the following code to the end of the file:

```jsx
export function useShow(id) {
  const [show, setShow] = useState();

  useEffect(() => {
    if (id) {
      const fetchData = async () => {
        const show = await getShows(id);
        setShow(show);
      };
      fetchData();
    }
  }, [id]);

  return show;
}
```

`useShow` receives an `id` and uses it to fetch the show, the `useEffect` in this case has `id` as a dependency, so whenever `id` changes, it'll fetch the show, we also have a conditional to only fetch the show if there's an `id`

Our new hooks are ready, in the next step we'll add them to the pages, you can also to do it yourself before continuing with the next step.

export default ({ children }) => <Layout meta={meta}>{children}</Layout>;
