import Layout from '../../../../components/learn/Layout';
import AnswerBox from '../../../../components/learn/AnswerBox';

export const meta = {
  title: 'CSR',
  courseId: 'excel',
  lessonId: 'csr',
  stepId: 'common-hooks'
};

## Common Hooks

React Hooks are very powerful as you can see, and we can improve our current implementation even more.

Let's start by moving our new data fetch hook to a common lib, that way we can use it in any component, open `lib/shows.js` and replace the content with the following:

```jsx
import { useState, useEffect } from 'react';
import fetch from 'isomorphic-unfetch';

export async function getShows(id) {
  await new Promise(resolve => setTimeout(() => resolve(), 1000));

  if (id) {
    const res = await fetch(`https://api.tvmaze.com/shows/${id}`);
    const show = await res.json();

    return show;
  } else {
    const res = await fetch('https://api.tvmaze.com/search/shows?q=batman');
    const data = await res.json();

    return data.map(entry => entry.show);
  }
}

function fetchShows(setData, id) {
  let isMounted = true;

  const fetchData = async () => {
    const shows = await getShows(id);
    // Only change the state if the component is still mounted after the fetch finishes
    if (isMounted) {
      setData(shows);
    }
  };
  fetchData();

  // This function will be executed by useEffect if the component is unmounted
  return () => {
    isMounted = false;
  };
}

export function useShows() {
  const [shows, setShows] = useState();

  useEffect(() => {
    return fetchShows(setShows);
  }, []);

  return shows;
}

export function useShow(id) {
  const [show, setShow] = useState();

  useEffect(() => {
    if (id) {
      return fetchShows(setShow, id);
    }
  }, [id]);

  return show;
}
```

`useShows` and `useShow` follow the [name convention for hooks](https://reactjs.org/docs/hooks-overview.html#building-your-own-hooks), they fetch and return shows to any component using them.

`useShow` receives an `id` and uses it to fetch the show, it also has `id` as a dependency, so whenever `id` changes it will fetch the show. We also have a conditional to only fetch the show if there's an `id`.

Our new hooks are ready, in the next step we'll add them to the pages, you can also do it yourself before continuing with the next step.

export default ({ children }) => <Layout meta={meta}>{children}</Layout>;
